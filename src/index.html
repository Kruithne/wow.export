<!DOCTYPE html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<script defer type="text/javascript" src="app.js"></script>
		<link rel="stylesheet" type="text/css" data-href="app.css" href="app.css"/>
		<title>wow.export</title>
	</head>
	<body>
		<div id="logo-background"></div>
		<div id="container" v-cloak>
			<div id="header" :class="{ shadowed: toast !== null }">
				<div id="logo" @click="setActiveModule(mpq ? 'legacy_tab_home' : 'tab_home')" :class="{ active: activeModule && (activeModule.__name === 'tab_home' || activeModule.__name === 'legacy_tab_home') }" style="cursor: pointer;">wow.export</div>
				<div id="nav">
					<template v-if="(activeModule && !activeModule.__name.startsWith('legacy_')) || (!!screen && screen.startsWith('tab-'))">
						<template v-for="btn in modNavButtons" :key="btn.module">
							<div v-if="btn.installTypes & 2" class="option nav-module" @click="setActiveModule(btn.module)" :class="{ active: activeModule && activeModule.__name === btn.module }" :style="'--nav-icon: url(./fa-icons/' + btn.icon + ')'">{{ btn.label }}</div>
						</template>
					</template>
					<template v-if="(activeModule && activeModule.__name.startsWith('legacy_')) || (!!screen && screen.startsWith('legacy-'))">
						<template v-for="btn in modNavButtons" :key="btn.module">
							<div v-if="btn.installTypes & 1" class="option nav-module" @click="setActiveModule(btn.module)" :class="{ active: activeModule && activeModule.__name === btn.module }" :style="'--nav-icon: url(./fa-icons/' + btn.icon + ')'">{{ btn.label }}</div>
						</template>
					</template>
					<div id="nav-help" v-if="!isBusy" @click="setActiveModule('tab_help')"></div>
					<div id="nav-extra" v-if="!isBusy" @click="contextMenus.stateNavExtra = true"></div>
					<context-menu @close="contextMenus.stateNavExtra = false" :node="contextMenus.stateNavExtra" id="menu-extra">
						<template v-for="opt in modContextMenuOptions" :key="opt.id">
							<span v-if="!opt.action?.dev_only || isDev" @click.self="handleContextMenuClick(opt)" :style="opt.icon ? 'background-image: url(./fa-icons/' + opt.icon + ')' : ''">{{ opt.label }}</span>
						</template>
					</context-menu>
				</div>
			</div>
			<div id="drop-overlay" v-if="!!fileDropPrompt">
				<div id="drop-overlay-icon"></div>
				<div id="drop-overlay-text">» {{ fileDropPrompt }} «</div>
			</div>
			<div id="content">
				<div id="loading" v-if="isLoading">
					<div id="loading-background" :class="{ xmas: isXmas }"></div>
					<div id="loading-icon"></div>
					<span id="loading-title">{{ loadingTitle }}</span>
					<span id="loading-progress">{{ loadingProgress }}</span>
					<div id="loading-bar">
						<div :style="{ width: (loadPct * 100) + '%' }"></div>
					</div>
				</div>
				<div id="module-container" v-if="activeModule">
					<keep-alive>
						<component :is="activeModule"></component>
					</keep-alive>
				</div>
				<div id="config" v-else-if="screen === 'config'" :class="{ toastgap: toast !== null }">
					<div>
						<h1>Export Directory</h1>
						<p>Local directory where files will be exported to.</p>
						<p v-if="isEditExportPathConcerning" class="concern">Warning: Using an export path with spaces may lead to problems in most 3D programs.</p>
						<file-field v-model="configEdit.exportDirectory" :class="{ concern: isEditExportPathConcerning }"></file-field>
					</div>
					<div>
						<h1>Scroll Speed</h1>
						<p>How many lines at a time you scroll down in the results view (leave at 0 for default scroll amount)</p>
						<input type="number" v-model.number="configEdit.scrollSpeed"/>
					</div>
					<div>
						<h1>Display File Lists in Numerical Order (FileDataID)</h1>
						<p>If enabled, all file lists will be ordered numerically by file ID, otherwise alphabetically by filename.</p>
						<label class="ui-checkbox">
						<input type="checkbox" v-model="configEdit.listfileSortByID"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Find Unknown Files (Requires Restart)</h1>
						<p>If enabled, wow.export will use various methods to locate unknown files.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableUnknownFiles"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Load Model Skins (Requires Restart)</h1>
						<p>If enabled, wow.export will parse creature and item skins from data tables for M2 models.</p>
						<p>Disabling this will reduce memory usage and improve loading, but will disable M2 skin functionality.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableM2Skins"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Include Bone Prefixes</h1>
						<p>If enabled, wow.export will Include _p Bone prefixes in model skeleton/armature.</p>
						<p>Disabling this will break backwards compatibility with previous glTF model and animation exports.</p>
						<label class="ui-checkbox" title="">
							<input type="checkbox" v-model="configEdit.modelsExportWithBonePrefix"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Enable Shared Textures (Recommended)</h1>
						<p>If enabled, exported textures will be exported to their own path rather than with their parent.</p>
						<p>This dramatically reduces disk space used by not duplicating textures.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableSharedTextures"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Enable Shared Children (Recommended)</h1>
						<p>If enabled, exported models on a WMO/ADT will be exported to their own path rather than with their parent.</p>
						<p>This dramatically reduces disk space used by not duplicating models.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableSharedChildren"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Strip Whitespace From Export Paths</h1>
						<p>If enabled, whitespace will be removed from exported paths.</p>
						<p>Enable this option if your 3D software does not support whitespace in paths.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.removePathSpaces"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Strip Whitespace From Copied Paths</h1>
						<p>If enabled, file paths copied from a listbox (CTRL + C) will have whitespace stripped.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.removePathSpacesCopy"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Path Separator Format</h1>
						<p>Sets the path separator format used in exported files.</p>
						<ul class="ui-multi-button" id="export-meta-multi">
							<li :class="{ selected: configEdit.pathFormat == 'win32' }" @click.stop="configEdit.pathFormat = 'win32'">Windows</li>
							<li :class="{ selected: configEdit.pathFormat == 'posix' }" @click.stop="configEdit.pathFormat = 'posix'">POSIX</li>
						</ul>
					</div>
					<div>
						<h1>Use Absolute MTL Texture Paths</h1>
						<p>If enabled, MTL files will contain absolute textures paths rather than relative ones.</p>
						<p>This will cause issues when sharing exported models between computers.</p>
						<p>Enable this option if you are having issues importing OBJ models with Shared Textures enabled.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableAbsoluteMTLPaths"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Use Absolute glTF Texture Paths</h1>
						<p>If enabled, glTF files will contain absolute textures paths rather than relative ones.</p>
						<p>This will cause issues when sharing exported models between computers.</p>
						<p>Enable this option if you are having issues importing glTF models with Shared Textures enabled.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableAbsoluteGLTFPaths"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Use Absolute Model Placement Paths</h1>
						<p>If enabled, paths inside model placement files (CSV) will contain absolute paths rather than relative ones.</p>
						<p>This will cause issues when sharing exported models between computers.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableAbsoluteCSVPaths"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>CASC Locale</h1>
						<p>Which locale to use for file reading. This only affects game files.</p>
						<p>This should match the locale of your client when using local installations.</p>
						<div style="width: 150px">
							<menu-button class="spaced" :dropdown="true" :options="availableLocaleKeys" :default="selectedLocaleKey" @change="configEdit.cascLocale = availableLocale.flags[$event]"></menu-button>
						</div>
					</div>
					<div>
						<h1>WebP Quality</h1>
						<p>Quality setting for WebP exports. Range is 1-100 (100 is lossless)</p>
						<input type="number" min="1" max="100" v-model.number="configEdit.exportWebPQuality"/>
					</div>
					<div>
						<h1>Export Model Collision</h1>
						<p>If enabled, M2 models exported as OBJ will also have their collision exported into a .phys.obj file.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.modelsExportCollision"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Export Additional UV Layers</h1>
						<p>If enabled, additional UV layers will be exported for M2/WMO models, included as non-standard properties (vt2, vt3, etc) in OBJ files.</p>
						<p>Use the wow.export Blender add-on to import OBJ models with additional UV layers.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.modelsExportUV2"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Export Meta Data</h1>
						<p>If enabled, verbose data will be exported for enabled formats into relative .json files.</p>
						<ul class="ui-multi-button" id="export-meta-multi">
							<li :class="{ selected: configEdit.exportM2Meta }" @click.stop="configEdit.exportM2Meta = !configEdit.exportM2Meta">M2</li>
							<li :class="{ selected: configEdit.exportWMOMeta }" @click.stop="configEdit.exportWMOMeta = !configEdit.exportWMOMeta">WMO</li>
							<li :class="{ selected: configEdit.exportBLPMeta }" @click.stop="configEdit.exportBLPMeta = !configEdit.exportBLPMeta">BLP</li>
							<li :class="{ selected: configEdit.exportFoliageMeta }" @click.stop="configEdit.exportFoliageMeta = !configEdit.exportFoliageMeta">Foliage</li>
						</ul>
					</div>
					<div>
						<h1>Export M2 Bone Data</h1>
						<p>If enabled, bone data will be exported in a relative _bones.json file.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.exportM2Bones"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Always Overwrite Existing Files (Recommended)</h1>
						<p>When exporting, files will always be written to disk even if they exist.</p>
						<p>Disabling this can speed up exporting, but may lead to issues between versions.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.overwriteFiles"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Name Exported Files</h1>
						<p>When enabled, files are exported using their listfile names (e.g., "ability_stealth.png").</p>
						<p>When disabled, files are exported using their fileDataID numbers (e.g., "12345.png").</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.exportNamedFiles"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Prevent 3D Preview Overwrites</h1>
						<p>If enabled, 3D preview exports will add increments to prevent overwriting existing files.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.modelsExportPngIncrements"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Regular Expression Filtering (Advanced)</h1>
						<p>Allows use of regular expressions in filtering lists.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.regexFilters"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Copy Mode</h1>
						<p>By default, using CTRL + C on a file list will copy the full entry to your clipboard.</p>
						<p>Setting this to Directory will instead only copy the directory of the given entry.</p>
						<p>Setting this to FileDataID will instead only copy the FID of the entry (must have FIDs enabled).</p>
						<ul class="ui-multi-button" id="export-copy-multi">
							<li :class="{ selected: configEdit.copyMode == 'FULL' }" @click.stop="configEdit.copyMode = 'FULL'">Full</li>
							<li :class="{ selected: configEdit.copyMode == 'DIR' }" @click.stop="configEdit.copyMode = 'DIR'">Directory</li>
							<li :class="{ selected: configEdit.copyMode == 'FID' }" @click.stop="configEdit.copyMode = 'FID'">FileDataID</li>
						</ul>
					</div>
					<div>
						<h1>Paste Selection</h1>
						<p>If enabled, using CTRL + V on the model list will attempt to select filenames you paste.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.pasteSelection"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Split Large Terrain Maps (Recommended)</h1>
						<p>If enabled, exporting baked terrain above 8k will be split into smaller files rather than one large file.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.splitLargeTerrainBakes"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Split Alpha Maps</h1>
						<p>If enabled, terrain alpha maps will be exported as individual images for each ADT chunk.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.splitAlphaMaps"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Show unknown items</h1>
						<p>When enabled, wow.export will list all items in the items tab, even those without a name.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.itemViewerShowAll"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Cache Expiry</h1>
						<p>After how many days of inactivity is cached data deleted. Setting to zero disables cache clean-up (not recommended).</p>
						<input type="number" v-model.number="configEdit.cacheExpiry"/>
					</div>
					<div>
						<h1>Manually Clear Cache (Requires Restart)</h1>
						<p>While housekeeping on the cache is mostly automatic, sometimes clearing manually can resolve issues.</p>
						<input type="button" class="spaced" :value="'Clear Cache (' + cacheSizeFormatted + ')'" @click="click('cache-clear', $event)" :class="{ disabled: isBusy }"/>
					</div>
					<div>
						<h1>Encryption Keys</h1>
						<p>Remote URL used to update keys for encrypted files.</p>
						<p>Primary <input type="text" class="long" v-model.trim="configEdit.tactKeysURL"/></p>
						<p>Fallback <input type="text" class="long" v-model.trim="configEdit.tactKeysFallbackURL"/></p>
					</div>
					<div>
						<h1>Add Encryption Key</h1>
						<p>Manually add a BLTE encryption key.</p>
						<input type="text" width="140" v-model.trim="userInputTactKeyName" maxlength="16" placeholder="e.g 8F4098E2470FE0C8"/>
						<input type="text" width="280" v-model.trim="userInputTactKey" maxlength="32" placeholder="e.g AA718D1F1A23078D49AD0C606A72F3D5"/>
						<input type="button" value="Add" @click="click('tact-key', $event)"/>
					</div>
					<div>
						<h1>Realm List Source</h1>
						<p>Remote URL used for retrieving the realm list. (Must use same format)</p>
						<p><input type="text" class="long" v-model.trim="configEdit.realmListURL"/></p>
					</div>
					<div>
						<h1>Character Appearance API Endpoint</h1>
						<p>Remote URL used for retrieving data from the Battle.net Character Appearance API. (Must use same format)</p>
						<p><input type="text" class="long" v-model.trim="configEdit.armoryURL"/></p>
					</div>
					<div>
						<h1>Use Binary Listfile Format (Requires Restart)</h1>
						<p>If enabled, wow.export will use the optimized binary listfile format instead of the legacy CSV format.</p>
						<label class="ui-checkbox">
							<input type="checkbox" v-model="configEdit.enableBinaryListfile"/>
							<span>Enable</span>
						</label>
					</div>
					<div>
						<h1>Listfile Binary Source</h1>
						<p>Remote URL used for downloading the optimized binary listfile format. (Must use same format)</p>
						<p><input type="text" class="long" v-model.trim="configEdit.listfileBinarySource"/></p>
					</div>
					<div>
						<h1>Listfile Source (Legacy)</h1>
						<p>Remote URL or local path used for updating the CASC listfile. (Must use same format)</p>
						<p>Primary <input type="text" class="long" v-model.trim="configEdit.listfileURL"/></p>
						<p>Fallback <input type="text" class="long" v-model.trim="configEdit.listfileFallbackURL" /></p>
					</div>
					<div>
						<h1>Listfile Update Frequency</h1>
						<p>How often (in days) the listfile is updated. Set to zero to always re-download the listfile.</p>
						<input type="number" v-model.number="configEdit.listfileCacheRefresh"/>
					</div>
					<div>
						<h1>Data Table Definition Repository</h1>
						<p>Remote URL used to update DBD definitions. (Must use same format)</p>
						<p>Primary <input type="text" class="long" v-model.trim="configEdit.dbdURL"/></p>
						<p>Fallback <input type="text" class="long" v-model.trim="configEdit.dbdFallbackURL" /></p>
					</div>
					<div>
						<h1>DBD Manifest Repository</h1>
						<p>Remote URL used to obtain DBD manifest information. (Must use same format)</p>
						<p>Primary <input type="text" class="long" v-model.trim="configEdit.dbdFilenameURL"/></p>
						<p>Fallback <input type="text" class="long" v-model.trim="configEdit.dbdFilenameFallbackURL" /></p>
					</div>
					<div>
						<h1>Last Export File Location</h1>
						<p>Override the text file location which export manifest entries are written to.</p>
						<input type="text" v-model.trim="configEdit.lastExportFile" :placeholder="lastExportPathDefault" class="long"/>
					</div>
				</div>
				<div id="toast" v-if="toast" :class="toast.type">
					{{ toast.message }}
					<span v-for="(func, label) in toast.options" @click="handleToastOptionClick(func)">{{ label }}</span>
					<div class="close" v-if="toast.closable" @click="hideToast(true)"></div>
				</div>
				<div id="toast" v-if="!toast && screen === 'tab-models' && overrideModelList.length > 0" class="progress">
					Filtering models for item: {{ overrideModelName }}
					<span @click="removeOverrideModels">Remove</span>
					<div class="close" @click="removeOverrideModels"></div>
				</div>
			</div>
			<div id="footer">
				<template v-if="screen === 'config'">
					<div id="config-buttons">
						<input type="button" value="Discard" :class="{ disabled: isBusy }" @click="click('config-discard', $event)"/>
						<input type="button" value="Apply" :class="{ disabled: isBusy }" @click="click('config-apply', $event)"/>
						<input type="button" id="config-reset" value="Reset to Defaults" :class="{ disabled: isBusy }" @click="click('config-reset', $event)"/>
					</div>
				</template>
				<template v-else>
					<span id="footer-links">
						<a data-external="::WEBSITE">Website</a> - 
						<a data-external="::DISCORD">Discord</a> - 
						<a data-external="::PATREON">Patreon</a> - 
						<a data-external="::GITHUB">GitHub</a>
					</span>
					<span id="footer-copyright">
						World of Warcraft and related trademarks are registered trademarks of Blizzard Entertainment whom this application is not affiliated with.
					</span>
				</template>
			</div>
		</div>
		<noscript>
			<div id="crash-screen">
				<h1>Oh no! The kākāpō has exploded...</h1>
				<div id="crash-screen-versions">
					<span id="crash-screen-version">???</span>
					<span id="crash-screen-flavour">???</span>
					<span id="crash-screen-build">???</span>
				</div>
				<div id="crash-screen-text">
					<span id="crash-screen-text-code">ERR_BROKEN:</span>
					<span id="crash-screen-text-message">Something went so terribly wrong that we don't even have an error message.</span>
				</div>
				<div class="form-tray">
					<input type="button" value="Report Issue" data-external="::ISSUE_TRACKER"/>
					<input type="button" value="Get Help on Discord" data-external="::DISCORD"/>
					<input type="button" value="Copy Log to Clipboard" onclick="nw.Clipboard.get().set(document.querySelector('#crash-screen-log').value, 'text')"/>
					<input type="button" value="Restart Application" onclick="chrome.runtime.reload()"/>
				</div>
				<textarea id="crash-screen-log">No runtime log available.</textarea>
			</div>
		</noscript>
	</body>
</html>
